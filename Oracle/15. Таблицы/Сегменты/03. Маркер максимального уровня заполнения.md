# HWM. Маркер максимального уровня заполнения

### Описание
Это индикатор использования блоков (USED BLOCKS) в базе данных. 
Блоки идущие до линии HWM - используемые блоки и содержат данные. 


### Фрагментированная таблица
  - Это когда в таблице есть пустые блоки до линии HWM.
  - Пустые блоки могут образоваться из за команды delete.
  - Потому что delete удаляет строки в блоках, но сами пустые блоки нет. 
  - А вот truncate как раз удаляет блоки


### Пример
````
insert into t select level col from dual connect by level <= 10000000; # Вставляем много строк
delete from t;                                                         # Удаляем все строки

select count(*) from t;                                                # Запрос работает 5 мин и возвращает 0
````


### Как сделать дефрагментацию
  - alter table t move
  - export / truncate / import
    - Удалит все блоки и сбросит HWM
  - ALTER TABLE имя_таблицы SHRINK SPACE [COMPACT] [CASCADE];
    - Перемещаем строки из полупустых блоков влево. Тем самым ужимая их.
    - Если указать COMPACT, то HWM не будет сброшен.
    - Если указать CASCADE, то сожмет еще и индексы. 
    - Это онлайн операция. Не нужно останавливать БД. Все индексы остаются валидными.