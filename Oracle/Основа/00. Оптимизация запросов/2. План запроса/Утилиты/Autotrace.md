# Autotrace

### Параметры запуска: 
````
set autotrace off;                   # Отключить вывод любых отчетов
set autotrace on explain;            # Строки + план
set autotrace on statistics;         # Строки + статистика
set autotrace on;                    # Строки + план + статистика
set autotrace traceonly;             # План + статистика
set autotrace traceonly statistics;  # Статистика
set autotrace traceonly explain;     # План
````

### Статистика
  - recursive calls                        # Рекурсивные запросы SQL. Если при выполнении SQL запрос запускается еще один SQL запрос, то он рекурсивный.
  - db block gets                          # Чтение блоков (I/O) из буферного кеша как они есть на текущий момент. Используется в DML.
  - consistent gets                        # Чтение блоков (I/O) из буферного кеша по состоянию на момент начала SQL оператора. Используется в SELECT, Т.к. нужно согласованое чтение.
  - physical reads                         # Чтение блоков (I/O) с диска в буферный кеш.
  - redo size                              # На сколько байтов создано редо логов (например 18 000 000 это 18 мб)
  - bytes sent via SQLNet to client        # Общее число байтов, отправленных клиенту с сервера
  - bytes received via SQLNet from client  # Общее число байтов, полученных от клиента
  - SQLNet roundtrips to/from client       # Общее кол-во отправленных и полученных сообщений SQL net от клиента
  - sorts (memory)                         # Кол-во сортировок, выполненых в памяти сессии пользователя.
  - sorts (disk)                           # Кол-во сортировок, которые использует диск (TEMP) из-за превышения размера области сортировки пользователя.
  - rows processed                         # Кол-во строк, изменяемых или возвращаемых в результате работы оператора SELECT 


## Подробнее о каждой статистике: 

### redo size 
  - Это полезный показатель при оценке эффективности массовых операций, таких как прямые вставки или create table as select 

Чем генерятся:
  - MERGE
  - UPDATE
  - DELETE
  - INSERT 

Оссобености прямой вставки: 
  - Прямая вставка не будет генерить редо, только в случаях 
    - При использовании режима базы данных NOARCHIVELOG
	- Или если таблица с опцией NOLOGGING

Причины почему не следует устанавливать NOLOGGING и применять APPEND ко всем операциям вставки:
  - Прямая вставка записывает данные выше HWM. Например если вы удалите delete все данные в таблице, то вставка не будет использовать все освободившееся место. Придется скидывать HWM.

Роль индексов при прямой вставке: 
  - Перед прямой вставкой нужно отключать индексы. Ведь данные вставляются в индексы. И генерятся редо логи - это обязательно. Потому что в случае чего можно будет восстановить структуру индекса.
  ````
  alter index big_table_idx unusable;
  ````
  
  - Установить параметр сессии, так чтобы пропускать индексы unusable
  ````
  alter session set skip_unusable_indexes = true;
  ````
  
  - Прозвести прямую вставку
  ````
  insert /*APPEND*/ into big_table select * from all_objects; 
  ````
  
  - Включить обратно индексы и перестроить их 
  ````
  alter index big_table_idx rebuild nologging;
  ````