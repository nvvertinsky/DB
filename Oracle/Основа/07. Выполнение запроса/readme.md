# Как выполняется фаза execute



### При SELECT + FULL SCAN
  1. В PGA (или UGA уточнить) в курсорной области создается курсор.
  2. Серверный процесс считывает блок с данными в буферный кеш.
  3. В блоке ищем нужную нам запись
  4. Если нашли нужную запись, то вытаскиваем ее и переносим в область сортировки в PGA
  
  
### SELECT + INDEX B-TREE
  1. Берем первый блок индекса (корень) в буферный кеш
  2. В считанном блоке есть информация о том какой следующий блок брать (ветви)
  3. Таким образом доходим до того, что считываем с диска листовой блок индекса.
  4. В листовом блоке есть rowid нужной нам записи.
  5. Считываем с диска по rowid нужный нам блок. 
  6. В блоке находим нужную запись
  7. Если нашли нужную запись, то вытаскиваем ее и переносим в область сортировки в PGA

### При UPDATE: 
  1. Синхронно. Серверный процесс считывает блок с данными в буферный кеш.
  2. Синхронно. Копирует этот блок в буферном кеше
  3. Синхронно. Ставит защелку у строки, которую нужно обновить
  4. Синхронно. Меняет данные в блоке.
  5. Ассинхронно. DBWR пишет НЕ измененный блок в табличное пространство undo. Получается в UNDO теперь блок с SCN = 1. Получается все строки в таблице, который хранились в этом блоке записаны в UNDO.
  6. Синхронно. Процесс LGWR записывает изнеменение в блоке в REDO журнал (который в оперативной памяти). Записывает только данные об измененной строке.
    6.1 Доп. Если REDO журнал в оперативной памяти заполнится на 1/3 или данные в нем находятся больше 3-х секунд, то LGWR скинет данные на диск.
  7. Пользователь нажимает commit
  8. LGWR скидывает данные об операции в файл логов REDO на диске.
  9. CKPT создает контрольную точку в conrol file. А именно записывает scn коммита.
  10. Снимается защелка с строки.
  11. Скопированный блок удаляется чтобы освободить место в буферном кеше.
  12. DBWR скидывает грязный блок на диск.
  


### Восстановление
Допустим scn контрольной точки 10. 
Текущий scn 90.

Сервер отрубается.

Сервер запускается и начинает сам востанавливать данные, а именно:
  - lgwr вычитывает данные из scn 90 до scn 10
  - Загоняет данные обратно к буферный кеш
  - а из буферного кеша потом dbwr скинет данные на диск