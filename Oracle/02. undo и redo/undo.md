### Определение:
Undo - это информация, которую Oracle сохраняет в сегментах отмены с целью отката транзакции

### Применение:
  - Чтобы вернуть состояние данных до их модификации
  
  
### Случай 1. HWM (фрагментированная таблица)
Описание: Фрагментированная таблица - таблица с пустыми блоками данных.

Как возникает: 
  - Выполняем большой insert в таблицу 
  - В следствии чего создается множество блоков и сегментов
  - Выполняем rollback
  - Данные возвращаются в изначальное состояние, но созданные блоки не удаляются
  - Если затем прочитать таблицу целиком, то кол во ввода вывода увеличится. И время выполнения чтения тоже
  - Потому что мы читаем намного больше блоков чем раньше. Потому что нужно в каждом блоке посмотреть, есть ли в нем данные


Как сбросить этот уровень: 
  - Оператором truncate
  - alter table + move
  - export / import
  - create table as select (CTAS)
  - dbms_redefinition  


### Случай 2. snapshot too old

Причины:
  - Выполняется долгий запрос. Допустим на момент начала запроса данные в undo еще есть. Но затем эти данные вымываются новыми.

Решения: 
  - Увеличьте размер или добавьте больше сегментов undo
  - Сократите время выполнения запроса
  - Увеличить параметр UNDO_RETENTION. Это насколько долго следует удерживать информацию в undo
    - Самые длительные транзакции можно определить v$undostat
    - Значение в секундах

Сценарий:
  - Каждая транзакция генерирует 8 Кбайт информации undo
  - Происходит 5 транзакций в секунду (40 Кбайт в сек, 2400 Кбайт в мин)
  - Есть транзакция которая генерирует 1 мбайт в мин
  - Итого генериться 3,5 мбайт информации undo в минуту
  - В системе сконфигурировано 15 мбайт под undo
  - Сегменты undo повторно задействуют пространство каждые 3-4 минуты
  - Появилась необходимость в формировании отчета. Длительность 5 мин
  - Т.к запрос берет информацию из undo, чтобы получить данные на время начала запроса, то можешь возникнуть ошибка.
  - Потому что информация в undo будет перезаписана, запрос не сможет показать согласованные данные на время начала запроса.

Решения для этого сценария: 
  - Уменьшить время выполнения запроса
  - Увеличить размер undo, чтобы перезаписование было каждые 10 мин